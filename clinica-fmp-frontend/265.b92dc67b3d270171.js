"use strict";(self.webpackChunkclinica_fmp_frontend=self.webpackChunkclinica_fmp_frontend||[]).push([[265],{2466:(R,Z,u)=>{u.d(Z,{i:()=>b});var g=u(5861),a=u(1571),_=u(3599),f=u(1622);let b=(()=>{class p{constructor(){this.tokenService=(0,a.f3M)(f.B),this.router=(0,a.f3M)(_.F0)}canActivate(c){var e=this;return(0,g.Z)(function*(){if(""===e.tokenService.getToken())return e.tokenService.logOut(),!1;try{if(yield e.tokenService.validarToken().toPromise()){const d=c.data.expectedAuthorities,v=e.tokenService.getAuthorities();return"ADMINISTRADOR"===e.tokenService.getRoles()[0]||d&&!!d.some(x=>v.includes(x))||(e.router.navigate(["/inicio"]),!1)}return!1}catch{return!1}})()}}return p.\u0275fac=function(c){return new(c||p)},p.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},4265:(R,Z,u)=>{u.r(Z),u.d(Z,{UsuarioModule:()=>ue});var g=u(6895),a=u(433),_=u(9061),f=u(3599),b=u(8372),p=u(1884),C=u(5226),c=u.n(C),e=u(1571),h=u(2340),d=u(529);let v=(()=>{class r{constructor(t){this.http=t,this.url=`${h.N.api}/rol`,this.isLoading=!1,this.listRoles={content:[],pageable:{sort:{empty:!0,unsorted:!0,sorted:!0},offset:0,pageSize:0,pageNumber:0,paged:!0,unpaged:!0},last:!0,totalPages:0,totalElements:0,size:0,number:0,sort:{empty:!0,unsorted:!0,sorted:!0},empty:!0,first:!0,numberOfElements:0}}getRolesByPage(t=0,o=5){return this.isLoading=!0,this.http.get(`${this.url}/list`,{params:{page:t.toString(),size:o.toString()}}).subscribe(i=>{this.listRoles=i,this.isLoading=!1})}buscarRolesByNombre(t=0,o=5,i=""){return this.isLoading=!0,this.http.get(`${this.url}/list-roles-filtrados`,{params:{page:t.toString(),size:o.toString(),nombre:i}}).subscribe(s=>{this.listRoles=s,this.isLoading=!1})}getModulos(){return this.http.get(`${this.url}/modulos`)}guardarRol(t){return this.http.post(`${this.url}/crear`,t)}actualizarRol(t,o){return this.http.put(`${this.url}/editar/${t}`,o)}buscarRol(t){return this.http.get(`${this.url}/detail/${t}`)}eliminarRol(t){return this.http.delete(`${this.url}/delete/${t}`)}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(d.eN))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function y(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"th",31),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td",32)(6,"button",33),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(),m=e.MAs(49);return e.KtG(l.openModal(m,s.id))}),e._UZ(7,"i",34),e.qZA(),e.TgZ(8,"button",35),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.eliminarRol(s.id))}),e._UZ(9,"i",36),e.qZA()()()}if(2&r){const t=n.$implicit,o=n.index;e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.rolNombre)}}function N(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td",37),e._uU(2),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.Oqu(t.isLoading?"cargando ...":"No se encontraron resultados")}}function x(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El nombre del rol es obligatorio"),e.qZA())}function E(r,n){if(1&r&&(e.TgZ(0,"li",55)(1,"a",56),e._uU(2),e.qZA()()),2&r){const t=n.$implicit,o=n.index;e.xp6(1),e.Q6J("ngClass",0===o?"active":""),e.uIk("href","#tab"+o,e.LSH),e.xp6(1),e.hij(" ",t.nombre," ")}}function w(r,n){if(1&r){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",63)(2,"input",62),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.crear=i)}),e.qZA()(),e.TgZ(3,"div",64)(4,"input",62),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.editar=i)}),e.qZA()(),e.TgZ(5,"div",65)(6,"input",62),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.eliminar=i)}),e.qZA()(),e.BQk()}if(2&r){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngModel",t.crear),e.xp6(2),e.Q6J("ngModel",t.editar),e.xp6(2),e.Q6J("ngModel",t.eliminar)}}function J(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"li")(1,"div",59)(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"div",60)(5,"div",61)(6,"input",62),e.NdJ("ngModelChange",function(i){const l=e.CHM(t).$implicit;return e.KtG(l.ver=i)}),e.qZA()(),e.YNc(7,w,7,3,"ng-container",28),e.qZA()()()}if(2&r){const t=n.$implicit,o=e.oxw().$implicit;e.xp6(3),e.Oqu(t.nombrePermiso),e.xp6(3),e.Q6J("ngModel",t.ver),e.xp6(1),e.Q6J("ngIf","CONSULTAS"!==o.nombre.toUpperCase())}}function k(r,n){if(1&r&&(e.TgZ(0,"div",57)(1,"ul",58),e.YNc(2,J,8,3,"li",27),e.qZA()()),2&r){const t=n.$implicit,o=n.index;e.Q6J("ngClass",0===o?"show active":"")("id","tab"+o),e.xp6(2),e.Q6J("ngForOf",t.permisos)}}function O(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"Seleccione al menos un permiso para el rol"),e.qZA())}function F(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",38)(1,"h4",39),e._uU(2,"Crear nuevo rol"),e.qZA(),e.TgZ(3,"button",40),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.dismiss("Cross click"))}),e.qZA()(),e.TgZ(4,"div",41)(5,"form",42),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.guardar())}),e.TgZ(6,"div",43)(7,"label",44),e._uU(8,"Nombre rol"),e.qZA(),e._UZ(9,"input",45),e.TgZ(10,"div",46),e.YNc(11,x,2,0,"span",28),e.qZA()()(),e.TgZ(12,"span",47),e._uU(13,"Permisos disponibles"),e.qZA(),e.TgZ(14,"ul",48),e.YNc(15,E,3,3,"li",49),e.qZA(),e.TgZ(16,"div",50),e.YNc(17,k,3,3,"div",51),e.qZA(),e.TgZ(18,"div",46),e.YNc(19,O,2,0,"span",28),e.qZA()(),e.TgZ(20,"div",52)(21,"button",53),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.close("Close click"))}),e._uU(22,"Cerrar"),e.qZA(),e.TgZ(23,"button",54),e._uU(24,"Guardar"),e.qZA()()}if(2&r){const t=e.oxw();let o,i;e.xp6(5),e.Q6J("formGroup",t.formularioRol),e.xp6(4),e.Q6J("ngClass",t.esCampoValido("nombreRol")),e.xp6(2),e.Q6J("ngIf",null==(o=t.formularioRol.get("nombreRol"))||null==o.errors?null:o.errors.required),e.xp6(4),e.Q6J("ngForOf",t.permisosMenu),e.xp6(1),e.Q6J("ngClass",t.esCampoValido("permisos")),e.xp6(1),e.Q6J("ngForOf",t.permisosMenu),e.xp6(2),e.Q6J("ngIf",null==(i=t.formularioRol.get("permisos"))||null==i.errors?null:i.errors.required)}}let I=(()=>{class r{constructor(t,o,i){this.modalService=t,this.rolService=o,this.fb=i,this.permisosMenu=[],this.permisos=[],this.currentPage=1,this.pageSize=5}ngOnInit(){this.formularioRol=this.iniciarFormularioRol(),this.rolService.getRolesByPage(),this.rolService.getModulos().subscribe(t=>{this.permisosMenu=t}),this.buscar=this.fb.group({filter:["",[]]}),this.buscar.get("filter")?.valueChanges.pipe((0,b.b)(100),(0,p.x)()).subscribe(t=>{this.pageSize=5,this.rolService.buscarRolesByNombre(0,this.pageSize,t)})}iniciarFormularioRol(){return this.fb.group({idRol:[""],nombreRol:["",[a.kI.required]],permisos:["",[a.kI.required]]})}esCampoValido(t){const o=this.formularioRol.get(t);return!o?.valid&&o?.touched?"is-invalid":o?.touched?"is-valid":""}get listRoles(){return this.rolService.listRoles}get isLoading(){return this.rolService.isLoading}openModal(t,o=""){this.limpiarPermisos(),this.formularioRol.reset(),o?this.rolService.buscarRol(o).subscribe(i=>{this.formularioRol.get("nombreRol")?.patchValue(i.rolNombre),this.formularioRol.get("idRol")?.patchValue(i.id),this.permisosMenu.forEach(s=>{s.permisos.forEach(l=>{i.permisos.forEach(m=>{l.idPermiso===m.permiso.idPermiso&&(l.ver=m.ver,l.crear=m.crear,l.editar=m.editar,l.eliminar=m.eliminar)})})}),this.modalService.open(t,{size:"lg",centered:!0})}):this.modalService.open(t,{size:"lg",centered:!0})}obtenerPermisos(){this.permisosMenu.forEach(t=>{t.permisos.forEach(o=>{(o.ver||o.crear||o.editar||o.eliminar)&&this.permisos.push(o)})})}limpiarPermisos(){this.permisosMenu.forEach(t=>{t.permisos.forEach(o=>{o.ver=!1,o.crear=!1,o.editar=!1,o.eliminar=!1})})}guardar(){if(this.obtenerPermisos(),this.permisos.length>0&&this.formularioRol.get("permisos")?.setValue("si"),this.formularioRol.valid){const t={nombre:this.formularioRol.get("nombreRol")?.value,permisos:this.permisos};this.formularioRol.get("idRol")?.value?this.rolService.actualizarRol(this.formularioRol.get("idRol")?.value,t).subscribe({next:()=>{c().fire("Exito","Se actualizo el registro con \xe9xito","success"),this.modalService.dismissAll(),this.rolService.getRolesByPage()},error:o=>{c().fire("Error",o.error.mensaje,"error")}}):this.rolService.guardarRol(t).subscribe({next:()=>{c().fire("Exito","Se guardo el registro con \xe9xito","success"),this.modalService.dismissAll(),this.rolService.getRolesByPage()},error:o=>{c().fire("Error",o.error.mensaje,"error")}}),this.permisos=[]}return Object.values(this.formularioRol.controls).forEach(t=>t.markAsTouched())}pageChange(t){this.rolService.getRolesByPage(t-1,this.pageSize)}eliminarRol(t){c().fire({title:"\xbfEst\xe1 seguro de eliminar este registro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&this.rolService.eliminarRol(t).subscribe({next:()=>{c().fire({icon:"success",title:"Eliminado",text:"El registro se ha eliminado exitosamente.",showConfirmButton:!0}),this.modalService.dismissAll(),this.rolService.getRolesByPage()},error:()=>{c().fire({icon:"error",title:"Error",text:"No se puede eliminar el rol, ya que est\xe1 asignado a uno o varios usuarios",showConfirmButton:!0})}})})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(_.FF),e.Y36(v),e.Y36(a.qu))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-rol"]],decls:50,vars:9,consts:[[1,"container-full"],[1,"header__page"],[1,"fs-2"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-3"],[1,"d-flex","justify-content-end","align-items-center"],[1,"btn","btn-primary","fs6",3,"click"],[1,"bi","bi-plus-square"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"mb-2","d-flex","align-items-center"],["for","table-filtering-search",1,"col-xs-3","col-sm-auto","col-form-label","me-1"],[1,"col-xs-3","col-sm-auto"],[1,"form-select",2,"width","auto","height","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],["for","table-filtering-search",1,"col-xs-3","col-sm-auto","col-form-label","ms-1"],[3,"formGroup"],[1,"d-flex","align-items-center"],["for","filter",1,"col-form-label","me-2"],["id","filter","type","text","formControlName","filter",1,"form-control"],[1,"table-responsive","mt-5"],[1,"table"],[1,"border-dark"],["scope","col"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","justify-content-end","p-2",3,"pageSize","collectionSize","pageChange","page"],["content",""],["scope","row"],[1,"d-flex","gap-1"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-x-lg"],["colspan","5",1,"text-center"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["id","formularioRol","name","formularioRol",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","nombreRol",1,"form-label"],["id","nombreRol","formControlName","nombreRol","autocomplete","off","type","text","placeholder","Administrador",1,"form-control",3,"ngClass"],[1,"invalid-feedback"],[1,"fw-semibold","text-danger","texti"],["id","myTabs","role","tablist",1,"nav","nav-tabs","mt-3"],["class","nav-item modulo-collap",4,"ngFor","ngForOf"],["id","myTabsContent",1,"tab-content",3,"ngClass"],["class","tab-pane fade","role","tabpanel",3,"ngClass","id",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","submit","form","formularioRol",1,"btn","btn-primary"],[1,"nav-item","modulo-collap"],["data-bs-toggle","tab","role","tab",1,"nav-link",3,"ngClass"],["role","tabpanel",1,"tab-pane","fade",3,"ngClass","id"],[1,"modulo-items","mt-4"],[1,"permisos"],[1,"accesos"],[1,"form-check","form-switch","switch-1"],["type","checkbox","role","switch",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"form-check","form-switch","switch-2"],[1,"form-check","form-switch","switch-3"],[1,"form-check","form-switch","switch-4"]],template:function(t,o){if(1&t){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),e._uU(3,"Rol"),e.qZA(),e.TgZ(4,"nav",3)(5,"ol",4)(6,"li",5)(7,"a",6),e._uU(8,"Inicio"),e.qZA()(),e.TgZ(9,"li",7),e._uU(10,"Rol"),e.qZA()()()(),e.TgZ(11,"div",8)(12,"div",9)(13,"button",10),e.NdJ("click",function(){e.CHM(i);const l=e.MAs(49);return e.KtG(o.openModal(l))}),e._UZ(14,"i",11),e.qZA()()(),e.TgZ(15,"div",12)(16,"div",13)(17,"label",14),e._uU(18,"Mostrar"),e.qZA(),e.TgZ(19,"div",15)(20,"select",16),e.NdJ("ngModelChange",function(l){return o.pageSize=l})("ngModelChange",function(){return o.pageChange(1)}),e.TgZ(21,"option",17),e._uU(22,"5"),e.qZA(),e.TgZ(23,"option",17),e._uU(24,"10"),e.qZA(),e.TgZ(25,"option",17),e._uU(26,"15"),e.qZA()()(),e.TgZ(27,"label",18),e._uU(28,"Registros"),e.qZA()(),e.TgZ(29,"form",19)(30,"div",20)(31,"label",21),e._uU(32,"Buscar:"),e.qZA(),e._UZ(33,"input",22),e.qZA()()(),e.TgZ(34,"div",23)(35,"table",24)(36,"thead")(37,"tr",25)(38,"th",26),e._uU(39,"#"),e.qZA(),e.TgZ(40,"th",26),e._uU(41,"Nombre Rol"),e.qZA(),e.TgZ(42,"th",26),e._uU(43,"Acciones"),e.qZA()()(),e.TgZ(44,"tbody"),e.YNc(45,y,10,2,"tr",27),e.YNc(46,N,3,1,"tr",28),e.qZA()()(),e.TgZ(47,"ngb-pagination",29),e.NdJ("pageChange",function(l){return o.pageChange(l)})("page",function(){return o.currentPage}),e.qZA(),e.YNc(48,F,25,7,"ng-template",null,30,e.W1O),e.qZA()}2&t&&(e.xp6(20),e.Q6J("ngModel",o.pageSize),e.xp6(1),e.Q6J("ngValue",5),e.xp6(2),e.Q6J("ngValue",10),e.xp6(2),e.Q6J("ngValue",15),e.xp6(4),e.Q6J("formGroup",o.buscar),e.xp6(16),e.Q6J("ngForOf",o.listRoles.content),e.xp6(1),e.Q6J("ngIf",0===o.listRoles.content.length),e.xp6(1),e.Q6J("pageSize",o.listRoles.pageable.pageSize)("collectionSize",o.listRoles.totalElements))},dependencies:[g.mk,g.sg,g.O5,f.yS,a._Y,a.YN,a.Kr,a.Fj,a.Wl,a.EJ,a.JJ,a.JL,a.On,a.sg,a.u,_.N9],styles:['.permisos[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr}@media only screen and (min-width: 530px){.permisos[_ngcontent-%COMP%]{grid-template-columns:220px 1fr}}.permisos[_ngcontent-%COMP%]   .accesos[_ngcontent-%COMP%]{width:100%;display:grid;padding:0 40px;grid-template-columns:repeat(auto-fit,minmax(20px,1fr))}.custom-width[_ngcontent-%COMP%]{width:250px}.modulo-items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .permisos[_ngcontent-%COMP%]   .accesos[_ngcontent-%COMP%]   .switch-1[_ngcontent-%COMP%]:before{content:"Ver";position:relative;top:-12px;left:-40px;display:block;width:10px;height:10px}.modulo-items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .permisos[_ngcontent-%COMP%]   .accesos[_ngcontent-%COMP%]   .switch-2[_ngcontent-%COMP%]:before{content:"Crear";position:relative;top:-12px;left:-40px;display:block;width:10px;height:10px}.modulo-items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .permisos[_ngcontent-%COMP%]   .accesos[_ngcontent-%COMP%]   .switch-3[_ngcontent-%COMP%]:before{content:"Editar";position:relative;top:-12px;left:-40px;display:block;width:10px;height:10px}.modulo-items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child   .permisos[_ngcontent-%COMP%]   .accesos[_ngcontent-%COMP%]   .switch-4[_ngcontent-%COMP%]:before{content:"Eliminar";position:relative;top:-12px;left:-40px;display:block;width:10px;height:10px}.modulo-collap[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000;text-decoration:none}.nav-link.active[_ngcontent-%COMP%]{font-weight:500}.color-primary[_ngcontent-%COMP%]{color:var(--red)}']}),r})();const P=/^[a-zA-Z0-9.]+@ues\.edu\.sv$/,$=/^[a-zA-Z0-9_]{3,50}$/,z=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%?&.])[A-Za-z\d@$!%?&.]{8,}$/;let Q=(()=>{class r{constructor(t){this.http=t,this.url=`${h.N.api}/usuario`,this.isLoading=!1,this.listPersonal=[],this.listRol=[],this.listUsuarios={content:[],pageable:{sort:{empty:!0,unsorted:!0,sorted:!0},offset:0,pageSize:0,pageNumber:0,paged:!0,unpaged:!0},last:!0,totalPages:0,totalElements:0,size:0,number:0,sort:{empty:!0,unsorted:!0,sorted:!0},empty:!0,first:!0,numberOfElements:0}}getUsuarioByPage(t=0,o=5){return this.isLoading=!0,this.http.get(`${this.url}`,{params:{page:t.toString(),size:o.toString()}}).subscribe(i=>{this.listUsuarios=i,this.isLoading=!1})}getUsuarioByFiltro(t=0,o=5,i=""){return this.isLoading=!0,this.http.get(`${this.url}/usuarios-filtro`,{params:{page:t.toString(),size:o.toString(),filtro:i}}).subscribe(s=>{this.listUsuarios=s,this.isLoading=!1})}guardarUsuario(t){return this.http.post(`${this.url}/save`,t)}actualizarUsuario(t,o){return this.http.put(`${this.url}/update/${t}`,o)}eliminarUsuario(t){return this.http.delete(`${this.url}/delete/${t}`)}getAllPersonalMedico(){return this.http.get(`${this.url}/getAll-personal`).subscribe(t=>{this.listPersonal=t})}getAllRoles(){return this.http.get(`${this.url}/getAll-roles`).subscribe(t=>{this.listRol=t})}buscarUsuario(t){return this.http.get(`${this.url}/detail/${t}`)}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(d.eN))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var U=u(723);function j(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"tr")(1,"th",30),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td",31)(12,"button",32),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(),m=e.MAs(55);return e.KtG(l.openModal(m,s.id))}),e._UZ(13,"i",33),e.qZA(),e.TgZ(14,"button",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.eliminar(s.id))}),e._UZ(15,"i",35),e.qZA()()()}if(2&r){const t=n.$implicit,o=n.index;e.xp6(2),e.Oqu(o+1),e.xp6(2),e.AsE("",t.nombre," ",t.apellido,""),e.xp6(2),e.Oqu(t.nombreUsuario),e.xp6(2),e.Oqu(t.cargo),e.xp6(2),e.Oqu(t.nombreRol)}}function G(r,n){if(1&r&&(e.TgZ(0,"tr")(1,"td",36),e._uU(2),e.qZA()()),2&r){const t=e.oxw();e.xp6(2),e.Oqu(t.isLoading?"cargando ...":"No se encontraron resultados")}}function Y(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El email es obligatorio"),e.qZA())}function L(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El formato del email no es v\xe1lido"),e.qZA())}function K(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El nombre de usuario es obligatorio"),e.qZA())}function V(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El nombre de usuario no es v\xe1lido"),e.qZA())}function H(r,n){if(1&r&&(e.TgZ(0,"ng-option",65),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.AsE("",t.nombre," ",t.apellido,"")}}function D(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El personal de salud es obligatorio"),e.qZA())}function W(r,n){if(1&r&&(e.TgZ(0,"ng-option",65),e._uU(1),e.qZA()),2&r){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.rolNombre)}}function X(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"El rol es obligatorio"),e.qZA())}function ee(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"La contrase\xf1a es obligatoria"),e.qZA())}function te(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"La contrase\xf1a debe contener al menos 8 caracteres, una may\xfascula, una min\xfascula, un d\xedgito y un car\xe1cter especial"),e.qZA())}function oe(r,n){1&r&&(e.TgZ(0,"span"),e._uU(1,"Las contrase\xf1as no coinciden"),e.qZA())}function re(r,n){if(1&r){const t=e.EpF();e.TgZ(0,"div",37)(1,"h4",38),e._uU(2,"Crear nuevo usuario"),e.qZA(),e.TgZ(3,"button",39),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.dismiss("Cross click"))}),e.qZA()(),e.TgZ(4,"div",40)(5,"form",41),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.guardar())}),e.TgZ(6,"div",42)(7,"label",43),e._uU(8,"Email"),e.qZA(),e.TgZ(9,"input",44),e.NdJ("blur",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.extraerNombreDeUsuario())}),e.qZA(),e.TgZ(10,"div",45),e.YNc(11,Y,2,0,"span",27),e.YNc(12,L,2,0,"span",27),e.qZA()(),e.TgZ(13,"div",42)(14,"label",46),e._uU(15,"Nombre de usuario "),e.qZA(),e._UZ(16,"input",47),e.TgZ(17,"div",45),e.YNc(18,K,2,0,"span",27),e.YNc(19,V,2,0,"span",27),e.qZA()(),e.TgZ(20,"div",42)(21,"label",48),e._uU(22,"Personal"),e.qZA(),e.TgZ(23,"ng-select",49),e.YNc(24,H,2,3,"ng-option",50),e.qZA(),e.TgZ(25,"div",45),e.YNc(26,D,2,0,"span",27),e.qZA()(),e.TgZ(27,"div",42)(28,"label",51),e._uU(29,"Rol "),e.qZA(),e.TgZ(30,"ng-select",52),e.YNc(31,W,2,2,"ng-option",50),e.qZA(),e.TgZ(32,"div",45),e.YNc(33,X,2,0,"span",27),e.qZA()(),e.TgZ(34,"label",53),e._uU(35,"Contrase\xf1a"),e.qZA(),e.TgZ(36,"div",54)(37,"input",55),e.NdJ("input",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.calcularPorcentajeAprobacion())}),e.qZA(),e.TgZ(38,"button",56),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.verContrasenia())}),e._UZ(39,"i"),e.qZA()(),e.TgZ(40,"div",57)(41,"div",58),e._uU(42),e.qZA()(),e.TgZ(43,"div",45),e.YNc(44,ee,2,0,"span",27),e.YNc(45,te,2,0,"span",27),e.qZA(),e.TgZ(46,"label",59),e._uU(47,"Confirmar Contrase\xf1a"),e.qZA(),e.TgZ(48,"div",60),e._UZ(49,"input",61),e.TgZ(50,"button",56),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.verContrasenia(2))}),e._UZ(51,"i"),e.qZA()(),e.TgZ(52,"div",45),e.YNc(53,oe,2,0,"span",27),e.qZA()()(),e.TgZ(54,"div",62)(55,"button",63),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.KtG(s.close("Close click"))}),e._uU(56,"Cerrar"),e.qZA(),e.TgZ(57,"button",64),e._uU(58,"Guardar"),e.qZA()()}if(2&r){const t=e.oxw();let o,i,s,l,m,A,q,S,M;e.xp6(5),e.Q6J("formGroup",t.formularioUsuario),e.xp6(4),e.Tol(t.esCampoValido("email")),e.xp6(2),e.Q6J("ngIf",null==(o=t.formularioUsuario.get("email"))||null==o.errors?null:o.errors.required),e.xp6(1),e.Q6J("ngIf",null==(i=t.formularioUsuario.get("email"))||null==i.errors?null:i.errors.pattern),e.xp6(6),e.Q6J("ngIf",null==(s=t.formularioUsuario.get("nombreUsuario"))||null==s.errors?null:s.errors.required),e.xp6(1),e.Q6J("ngIf",null==(l=t.formularioUsuario.get("nombreUsuario"))||null==l.errors?null:l.errors.pattern),e.xp6(4),e.Tol(t.esCampoValido("personalSalud")),e.xp6(1),e.Q6J("ngForOf",t.listPersonal),e.xp6(2),e.Q6J("ngIf",null==(m=t.formularioUsuario.get("personalSalud"))||null==m.errors?null:m.errors.required),e.xp6(4),e.Tol(t.esCampoValido("rol")),e.xp6(1),e.Q6J("ngForOf",t.listRol),e.xp6(2),e.Q6J("ngIf",null==(A=t.formularioUsuario.get("rol"))||null==A.errors?null:A.errors.required),e.xp6(4),e.Q6J("type",t.contrasenia1?"text":"password"),e.xp6(2),e.Tol(t.contrasenia1?"bi bi-eye-slash-fill":"bi bi-eye-fill"),e.xp6(1),e.Q6J("ngClass",t.esCampoValido("password")),e.xp6(1),e.Udp("width",t.porcentaje,"%"),e.Q6J("ngClass",t.colorBar),e.uIk("aria-valuenow",t.porcentaje),e.xp6(1),e.hij(" ",t.porcentaje,"% "),e.xp6(2),e.Q6J("ngIf",null==(q=t.formularioUsuario.get("password"))||null==q.errors?null:q.errors.required),e.xp6(1),e.Q6J("ngIf",null==(S=t.formularioUsuario.get("password"))||null==S.errors?null:S.errors.pattern),e.xp6(3),e.Q6J("ngClass",t.esCampoValido("confirmContrasenia")),e.xp6(1),e.Q6J("type",t.contrasenia2?"text":"password"),e.xp6(2),e.Tol(t.contrasenia2?"bi bi-eye-slash-fill":"bi bi-eye-fill"),e.xp6(2),e.Q6J("ngIf",null==(M=t.formularioUsuario.get("confirmContrasenia"))||null==M.errors?null:M.errors.noSonIguales)}}let ne=(()=>{class r{constructor(t,o,i,s){this.modalService=t,this.usuarioService=o,this.fb=i,this.config=s,this.currentPage=1,this.contrasenia1=!1,this.contrasenia2=!1,this.porcentaje=0,this.colorBar="",this.pageSize=5}ngOnInit(){this.config.notFoundText="No se encontraron coincidencias",this.usuarioService.getUsuarioByPage(),this.usuarioService.getAllPersonalMedico(),this.usuarioService.getAllRoles(),this.formularioUsuario=this.iniciarFormularioUsuario(),this.buscar=this.fb.group({filter:["",[]]}),this.buscar.get("filter")?.valueChanges.pipe((0,b.b)(100),(0,p.x)()).subscribe(t=>{this.pageSize=5,this.usuarioService.getUsuarioByFiltro(0,this.pageSize,t)})}iniciarFormularioUsuario(){return this.fb.group({idUsuario:[""],nombreUsuario:["",[a.kI.required,a.kI.pattern($)]],email:["",[a.kI.required,a.kI.pattern(P)]],password:["",[a.kI.required,a.kI.pattern(z),a.kI.maxLength(255)]],rol:[null,[a.kI.required]],confirmContrasenia:["",[a.kI.required]],personalSalud:[null,[a.kI.required]]},{validators:this.clavesSonIguales("password","confirmContrasenia")})}esCampoValido(t){const o=this.formularioUsuario.get(t);return!o?.valid&&o?.touched?"is-invalid":o?.touched?"is-valid":""}calcularPorcentajeAprobacion(){const t=this.formularioUsuario.get("password")?.value,o=[/[a-z]/.test(t),/[A-Z]/.test(t),/\d/.test(t),/[@$!%?&.]/.test(t),t.length>=8],s=o.filter(l=>l).length/o.length*100;return this.porcentaje=s,this.colorBar=this.calcularColorPorcentaje(),s}calcularColorPorcentaje(){return 0===this.porcentaje||this.porcentaje<40?"bg-danger":this.porcentaje>=40&&this.porcentaje<50?"bg-warning":this.porcentaje>=50&&this.porcentaje<=80?"bg-orange":this.porcentaje>80&&this.porcentaje<100?"bg-info":100===this.porcentaje?"bg-success":"bg-danger"}clavesSonIguales(t,o){return i=>{const l=i.controls[o];l.setErrors(i.controls[t]?.value===l.value?null:{noSonIguales:!0})}}get listUsuarios(){return this.usuarioService.listUsuarios}get listPersonal(){return this.usuarioService.listPersonal}get listRol(){return this.usuarioService.listRol}get isLoading(){return this.usuarioService.isLoading}verContrasenia(t=1){1===t?this.contrasenia1=!this.contrasenia1:this.contrasenia2=!this.contrasenia2}extraerNombreDeUsuario(){const t=this.formularioUsuario.get("email")?.value;if(P.test(t)){const i=t.split("@")[0];this.formularioUsuario.get("nombreUsuario")?.setValue(i)}else this.formularioUsuario.get("nombreUsuario")?.setValue("")}openModal(t,o=""){this.formularioUsuario.reset(),o?this.usuarioService.buscarUsuario(o).subscribe(i=>{this.formularioUsuario.setValue({idUsuario:i.id,nombreUsuario:i.nombreUsuario,email:i.email,rol:i.idRol,personalSalud:i.idPersonalSalud,password:"",confirmContrasenia:""}),this.modalService.open(t,{size:"md",centered:!0})}):this.modalService.open(t,{size:"md",centered:!0})}pageChange(t){this.usuarioService.getUsuarioByPage(t-1,this.pageSize)}guardar(){return this.formularioUsuario.valid&&(this.formularioUsuario.get("idUsuario")?.value?this.usuarioService.actualizarUsuario(this.formularioUsuario.get("idUsuario")?.value,this.formularioUsuario.value).subscribe({next:()=>{c().fire({icon:"success",title:"\xc9xito",text:"El usuario se ha guardado correctamente.",showConfirmButton:!0}),this.modalService.dismissAll(),this.usuarioService.getUsuarioByPage(),this.porcentaje=0,this.colorBar=""},error:t=>{c().fire({icon:"error",title:"Error",text:`${t.error.mensaje}`,showConfirmButton:!0})}}):this.usuarioService.guardarUsuario(this.formularioUsuario.value).subscribe({next:()=>{c().fire({icon:"success",title:"\xc9xito",text:"El usuario se ha guardado correctamente.",showConfirmButton:!0}),this.modalService.dismissAll(),this.usuarioService.getUsuarioByPage(),this.porcentaje=0,this.colorBar=""},error:t=>{c().fire({icon:"error",title:"Error",text:`${t.error.mensaje}`,showConfirmButton:!0})}})),Object.values(this.formularioUsuario.controls).forEach(t=>t.markAsTouched())}eliminar(t){c().fire({title:"\xbfEst\xe1 seguro de eliminar este registro?",text:"Esta acci\xf3n no se puede deshacer.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&this.usuarioService.eliminarUsuario(t).subscribe({next:()=>{c().fire({icon:"success",title:"Eliminado",text:"El registro se ha eliminado exitosamente.",showConfirmButton:!0}),this.modalService.dismissAll(),this.usuarioService.getUsuarioByPage()},error:i=>{c().fire({icon:"error",title:"Error",text:`${i.error.mensaje}`,showConfirmButton:!0})}})})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(_.FF),e.Y36(Q),e.Y36(a.qu),e.Y36(U.$q))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-usuario"]],decls:56,vars:9,consts:[[1,"container-full"],[1,"header__page"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-3"],[1,"d-flex","justify-content-end","align-items-center"],[1,"btn","btn-primary","fs6",3,"click"],[1,"bi","bi-plus-square"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"mb-2","d-flex","align-items-center"],["for","table-filtering-search",1,"col-xs-3","col-sm-auto","col-form-label","me-1"],[1,"col-xs-3","col-sm-auto"],[1,"form-select",2,"width","auto","height","auto",3,"ngModel","ngModelChange"],[3,"ngValue"],["for","table-filtering-search",1,"col-xs-3","col-sm-auto","col-form-label","ms-1"],[3,"formGroup"],[1,"d-flex","align-items-center"],["for","filter",1,"col-form-label","me-2"],["id","filter","type","text","formControlName","filter",1,"form-control"],[1,"table-responsive","mt-5"],[1,"table"],[1,"border-dark"],["scope","col"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"d-flex","justify-content-end","p-2",3,"pageSize","collectionSize","pageChange","page"],["content",""],["scope","row"],[1,"d-flex","gap-1"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-x-lg"],["colspan","6",1,"text-center"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["id","formUsuario","name","formUsuario",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","email",1,"form-label","fw-semibold"],["type","text","formControlName","email","id","email","placeholder","clinicau@ues.edu.sv","autocomplete","off",1,"form-control",3,"blur"],[1,"invalid-feedback"],["for","nombre",1,"form-label","fw-semibold"],["type","text","formControlName","nombreUsuario","id","nombre","placeholder","fernanda143","autocomplete","off","readonly","",1,"form-control"],["for","personal",1,"form-label","fw-semibold"],["formControlName","personalSalud","id","personal","placeholder","Seleccione una opci\xf3n"],[3,"value",4,"ngFor","ngForOf"],["for","rol",1,"form-label","fw-semibold"],["formControlName","rol","id","rol","placeholder","Seleccione una opci\xf3n"],["for","contrasenia",1,"form-label","fw-semibold"],[1,"input-group","mb-3"],["formControlName","password","id","contrasenia","placeholder","********","aria-label","Username","aria-describedby","basic-addon1",1,"form-control",3,"type","input"],["id","basic-addon1",1,"input-group-text","bg-transparent",3,"click"],[1,"progress","mb-3",3,"ngClass"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped",3,"ngClass"],["for","re-contrasenia",1,"form-label","fw-semibold"],[1,"input-group","mb-3",3,"ngClass"],["formControlName","confirmContrasenia","id","re-contrasenia","placeholder","********","aria-label","Username","aria-describedby","basic-addon1",1,"form-control",3,"type"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","submit","form","formUsuario",1,"btn","btn-primary"],[3,"value"]],template:function(t,o){if(1&t){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"h1"),e._uU(3,"Usuario"),e.qZA(),e.TgZ(4,"nav",2)(5,"ol",3)(6,"li",4)(7,"a",5),e._uU(8,"Inicio"),e.qZA()(),e.TgZ(9,"li",6),e._uU(10,"Usuario"),e.qZA()()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"button",9),e.NdJ("click",function(){e.CHM(i);const l=e.MAs(55);return e.KtG(o.openModal(l))}),e._UZ(14,"i",10),e.qZA()()(),e.TgZ(15,"div",11)(16,"div",12)(17,"label",13),e._uU(18,"Mostrar"),e.qZA(),e.TgZ(19,"div",14)(20,"select",15),e.NdJ("ngModelChange",function(l){return o.pageSize=l})("ngModelChange",function(){return o.pageChange(1)}),e.TgZ(21,"option",16),e._uU(22,"5"),e.qZA(),e.TgZ(23,"option",16),e._uU(24,"10"),e.qZA(),e.TgZ(25,"option",16),e._uU(26,"15"),e.qZA()()(),e.TgZ(27,"label",17),e._uU(28,"Registros"),e.qZA()(),e.TgZ(29,"form",18)(30,"div",19)(31,"label",20),e._uU(32,"Buscar:"),e.qZA(),e._UZ(33,"input",21),e.qZA()()(),e.TgZ(34,"div",22)(35,"table",23)(36,"thead")(37,"tr",24)(38,"th",25),e._uU(39,"#"),e.qZA(),e.TgZ(40,"th",25),e._uU(41,"Nombre completo"),e.qZA(),e.TgZ(42,"th",25),e._uU(43,"Nombre de usuario"),e.qZA(),e.TgZ(44,"th",25),e._uU(45,"Especialidad"),e.qZA(),e.TgZ(46,"th",25),e._uU(47,"Rol"),e.qZA(),e.TgZ(48,"th",25),e._uU(49,"Acciones"),e.qZA()()(),e.TgZ(50,"tbody"),e.YNc(51,j,16,6,"tr",26),e.YNc(52,G,3,1,"tr",27),e.qZA()()(),e.TgZ(53,"ngb-pagination",28),e.NdJ("pageChange",function(l){return o.pageChange(l)})("page",function(){return o.currentPage}),e.qZA(),e.YNc(54,re,59,31,"ng-template",null,29,e.W1O),e.qZA()}2&t&&(e.xp6(20),e.Q6J("ngModel",o.pageSize),e.xp6(1),e.Q6J("ngValue",5),e.xp6(2),e.Q6J("ngValue",10),e.xp6(2),e.Q6J("ngValue",15),e.xp6(4),e.Q6J("formGroup",o.buscar),e.xp6(22),e.Q6J("ngForOf",o.listUsuarios.content),e.xp6(1),e.Q6J("ngIf",0===o.listUsuarios.content.length),e.xp6(1),e.Q6J("pageSize",o.listUsuarios.pageable.pageSize)("collectionSize",o.listUsuarios.totalElements))},dependencies:[g.mk,g.sg,g.O5,f.yS,a._Y,a.YN,a.Kr,a.Fj,a.EJ,a.JJ,a.JL,a.On,a.sg,a.u,_.N9,U.w9,U.jq],styles:[".progress[_ngcontent-%COMP%]{height:3px!important}.show-pass[_ngcontent-%COMP%]{position:absolute;top:5%;right:8%}.bg-orange[_ngcontent-%COMP%]{background-color:#ff9100}.progress[_ngcontent-%COMP%]{height:15px!important}"]}),r})(),se=(()=>{class r{constructor(){}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-bitacora"]],decls:31,vars:0,consts:[[1,"container-full"],[1,"header__page"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-end"],[1,"btn","btn-primary","fs-4","mt-4"],[1,"bi","bi-plus-square"],[1,"table-responsive","mt-5"],[1,"table"],[1,"border-dark"],["scope","col"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h1"),e._uU(3,"Bit\xe1cora"),e.qZA(),e.TgZ(4,"nav",2)(5,"ol",3)(6,"li",4)(7,"a",5),e._uU(8,"Inicio"),e.qZA()(),e.TgZ(9,"li",6),e._uU(10,"Bit\xe1cora"),e.qZA()()()(),e.TgZ(11,"div",7)(12,"button",8),e._UZ(13,"i",9),e.qZA()(),e.TgZ(14,"div",10)(15,"table",11)(16,"thead")(17,"tr",12)(18,"th",13),e._uU(19,"#"),e.qZA(),e.TgZ(20,"th",13),e._uU(21,"Nombre completo"),e.qZA(),e.TgZ(22,"th",13),e._uU(23,"Nombre de usuario"),e.qZA(),e.TgZ(24,"th",13),e._uU(25,"Especialidad"),e.qZA(),e.TgZ(26,"th",13),e._uU(27,"Rol"),e.qZA(),e.TgZ(28,"th",13),e._uU(29,"Acciones"),e.qZA()()(),e._UZ(30,"tbody"),e.qZA()()())},dependencies:[f.yS]}),r})();var T=u(2466);const ae=[{path:"rol",component:I,canActivate:[T.i]},{path:"usuario",component:ne,canActivate:[T.i]},{path:"bitacora",component:se,canActivate:[T.i]}];let le=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[f.Bz.forChild(ae),f.Bz]}),r})(),ue=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[g.ez,le,a.u5,a.UX,_.jF,U.A0]}),r})()},5861:(R,Z,u)=>{function g(_,f,b,p,C,c,e){try{var h=_[c](e),d=h.value}catch(v){return void b(v)}h.done?f(d):Promise.resolve(d).then(p,C)}function a(_){return function(){var f=this,b=arguments;return new Promise(function(p,C){var c=_.apply(f,b);function e(d){g(c,p,C,e,h,"next",d)}function h(d){g(c,p,C,e,h,"throw",d)}e(void 0)})}}u.d(Z,{Z:()=>a})}}]);